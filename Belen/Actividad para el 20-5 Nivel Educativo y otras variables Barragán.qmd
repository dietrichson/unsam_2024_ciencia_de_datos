---
title: "6. Educacion e Ingreso"
author: "Barragán"
format: html
editor: visual
---

## Issue n°64: Capitulo Educación e ingreso

-   ¿En qué medida influye el **nivel educativo** en el **ingreso** de la persona?

    -   ¿Controlando por la variable de **sexo**?

    -   ¿Es lo mismo para todas las provincias y/o **regiones**?

    -   ¿Es lo mismo en **ciudades grandes** (+500) y en las **ciudades chicas**?

Variables a analizar en relación al nivel educativo(NIVEL_ED) y el ingreso (ITF):

-   Sexo (CH04)

-   Regiones (REGION)

-   Ciudades grandes y cuidades chicas(MAS_500)

```{r}
library(tidyverse)
```

```{r}
my_data <- readRDS("/cloud/project/data/usu_individual_T423.rds")
```

```{r}
temp_df <- my_data |> 
  select(NIVEL_ED,CH04,REGION,MAS_500)
```

## Cambiando nombre a las columnas

```{r}
temp_df |> 
  mutate (Nivel_Educativo = NIVEL_ED)
```

```{r}
temp_df |> 
  mutate (Ingreso = "ITF")
```

```{r}
## Cargar la funcion:
source(here::here("R/variables-nivel-educativo.R"))
source(here::here("R/nombrar-regiones.R"))
temp_df <- temp_df |> 
  mutate(Nivel_Educativo = nivel_educativo(NIVEL_ED))
temp_df |> 
  select(Nivel_Educativo) |> 
  head()
```

```         
```

```{r}
temp_df |> 
  mutate (Sexo = "CH04")
```

```{r}
temp_df <- temp_df |> 
  mutate(Sexo = case_when(
    CH04 == "1" ~ "Varon",
    CH04 == "2" ~ "Mujer",
    TRUE ~ "desconocido")
  )
## Verificamos
temp_df |> 
  select(Sexo) |> 
  head()
```

```{r}
# TODO: volcar a una función y cargar de alli, usar la carpeta R
conjunto_de_aglomerados <- function(aglomerado){
  case_when(
    aglomerado=="N"~ "menos de 500.000 habitantes",
    aglomerado=="S"~ "igual o más de 500.000 habitantes")
}


```

## Relacion del nivel educativo e ingreso con las variables (Regiones, Sexo y Aglomeración)

Regiones

```{r}
my_data <- my_data |> 
  mutate(Nivel_Educativo = NIVEL_ED) |>  
  mutate(Region = case_when( 
             REGION == 01 ~ "Gran Buenos Aires",
             REGION == 40 ~ "Noroeste",
             REGION == 41 ~ "Noreste",
             REGION == 42 ~ "Cuyo",
             REGION == 43 ~ "Pampeana",
             REGION == 44 ~ "Patagonia",
             TRUE ~ "No Encontrado" 
         )
  )

table(my_data$NIVEL_ED, my_data$Region)
```

```{r}
my_data <- my_data |> 
  mutate(Ingreso = ITF) |>  
  mutate(REGION = case_when( 
             REGION == 01 ~ "Gran Buenos Aires",
             REGION == 40 ~ "Noroeste",
             REGION == 41 ~ "Noreste",
             REGION == 42 ~ "Cuyo",
             REGION == 43 ~ "Pampeana",
             REGION == 44 ~ "Patagonia",
             TRUE ~ "No Encontrado" 
         )
  )

head(table(my_data$ITF, my_data$REGION), 6)

```

```{r}
my_data |> 
 # mutate(Region = nombrar_regiones(REGION)) |> 
  mutate(ingreso = ITF) |> 
  filter(ingreso > 0) |> 
  group_by(Region) |> 
  summarize(
    Media = mean(ingreso),
    Mediana = median(ingreso),
    Desviacion = sd(ingreso),
    Desvio = mad(ingreso)
  )
```

Sexo

```{r}
my_data <- my_data |> 
  mutate(Nivel_Educativo = NIVEL_ED) |> 
  mutate(Sexo = case_when(
    CH04 == "1" ~ "Varon",
    CH04 == "2" ~ "Mujer",
    TRUE ~ "desconocido"
  ))

table(my_data$Nivel_Educativo, my_data$Sexo)
```

### Nota:

1.  El nivel 7 = sin instrucción

```{r}
table(my_data$Sexo, my_data$Nivel_Educativo)
```

```{r}
my_data <- my_data |> 
   filter(ITF > 0) |> 
  mutate(Ingreso = ITF) |> 
  mutate(Sexo = case_when(
    CH04 == "1" ~ "Varon",
    CH04 == "2" ~ "Mujer",
    TRUE ~ "desconocido"
  ))

head(table(my_data$ITF, my_data$Sexo), 10)

```

```{r}
# Hacer un analisis de histograma

# my_data |> 
#   group
```

```{r}
source(here::here("R/nombrar-ch04.R"))
my_data |> 
  mutate(Sexo = nombrar_ch04(CH04)) |> 
  filter(Ingreso > 0) |> 
  group_by(Sexo) |> 
  summarize(
    Media = mean(Ingreso),
    Desviacion = sd(Ingreso), 
    Mediana = median(Ingreso),
    Desvio = mad(Ingreso)
  )
```

Aglomeracion

```{r}
my_data <- my_data |> 
  mutate(Nivel_Educativo = NIVEL_ED) |> 
  mutate(conjunto_de_aglomerados = case_when(
    MAS_500 == "N" ~ "menos de 500.000 habitantes",
    MAS_500 == "S" ~ "igual o más de 500.000 habitantes"
  ))

table(my_data$Nivel_Educativo, my_data$MAS_500)
```

```{r}
my_data <- my_data |> 
  mutate(Ingreso = ITF) |> 
  mutate(conjunto_de_aglomerados = case_when(
    MAS_500 == "N" ~ "menos de 500.000 habitantes",
    MAS_500 == "S" ~ "igual o más de 500.000 habitantes"
  ))

head(table(my_data$ITF, my_data$MAS_500), 6)
```

```{r}
my_data |> 
  mutate(conjunto_de_aglomerados =conjunto_de_aglomerados(MAS_500)) |> 
  filter(Ingreso > 0) |> 
  group_by(conjunto_de_aglomerados) |> 
  summarize(
    Media = mean(Ingreso),
    Desviacion = sd(Ingreso), 
    Mediana = median(Ingreso),
    Desvio = mad(Ingreso)
  )
```

Graficos

Region

```{r}
my_data |> 
  ggplot(aes(NIVEL_ED, fill = Region))+
  geom_bar()
```

```{r}
my_data |>
   filter(Ingreso > 0) |> 
   group_by(Region) |> 
    summarize(
    Ingreso = mean(Ingreso)
  ) |> 
  ggplot(aes(Region,fill = Ingreso))+
  geom_bar()
```

Sexo

```{r}
my_data |> 
  ggplot(aes(NIVEL_ED, fill = Sexo))+
  geom_bar()
```

```{r}
my_data |> 
  filter(Ingreso >0 ) |> 
  filter(NIVEL_ED != 7) |> 
  group_by(
    NIVEL_ED,
    Sexo
  ) |> 
  summarize(
    Ingreso = mean(Ingreso)
  ) |> 
  ggplot(aes(NIVEL_ED,Ingreso, color=Sexo ))+
  geom_point()+
  geom_smooth()
```

Aglomerados

```{r}
my_data |> 
  ggplot(aes(NIVEL_ED, fill = MAS_500))+
  geom_bar()
```

```{r}
my_data |> 
  filter(Ingreso >0 ) |> 
  filter(NIVEL_ED != 7) |> 
  group_by(
    NIVEL_ED,conjunto_de_aglomerados
  ) |> 
  summarize(
    Ingreso = mean(Ingreso)
  ) |> 
  ggplot(aes(NIVEL_ED,Ingreso, color=conjunto_de_aglomerados ))+
  geom_point()+
  geom_smooth()
```

## Propuestas de graficos

-   Cuales son las preguntas de investigación que querés contestar

-   Análisis descriptivo y inferencial

    ```{r}
    # Primer problema: 
    # El novel educativo 7 = sin instrucción Arreglemos eso.
    my_data <- my_data |> 
      mutate(
       Nivel_Educativo =  ifelse(Nivel_Educativo == 7, 0, Nivel_Educativo)
      )

    # Segundo problema: poner etiquetas para que los graficos queden lindos.
    my_data |> 
      group_by(Nivel_Educativo, REGION) |>
      summarize(
        Mediana = median(Ingreso)
      ) |> 
      ggplot(aes(Nivel_Educativo,Mediana,color=REGION))+
      geom_line()
      
      
      
    ```

Hay una paradoja en el grafico que puede tener que ver con la pregunta que hicimos (hizo Sasha),

```{r}
my_data |> 
  filter(Ingreso>10000) |> 
  group_by(Nivel_Educativo, REGION) |>
  summarize(
    Mediana = median(Ingreso)
  ) |> 
  ggplot(aes(Nivel_Educativo,Mediana,color=REGION))+
  geom_line()
```

```{r}
my_data |> 
  # filter(Ingreso>10000) |> 
  group_by(Nivel_Educativo, Sexo) |>
  summarize(
    Mediana = median(Ingreso)
  ) |> 
  ggplot(aes(Nivel_Educativo,Mediana,color=Sexo))+
  geom_line()+
  geom_point(size=2)
```

```{r}
my_data |> 
 group_by(Nivel_Educativo, Sexo) |>
  summarize(
    Mediana = median(Ingreso)
  )
```
